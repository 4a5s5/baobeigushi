<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 核心SEO标签 -->
    <title>AI语音助手 | 智能对话+文本转语音 - LibreTTS</title>
    <meta name="description" content="LibreTTS AI语音助手，集成智能对话和文本转语音功能，支持多种声音选择，可调节语速和语调，提供即时试听和下载功能。">
    <meta name="keywords" content="AI对话,文本转语音,TTS,语音合成,在线配音,智能助手,AI配音,免费TTS,在线朗读">
    <meta name="author" content="Zwei">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://libretts.is-an.org/">
    
    <!-- Open Graph标签 -->
    <meta property="og:title" content="AI语音助手 | 智能对话+文本转语音 - LibreTTS">
    <meta property="og:description" content="LibreTTS AI语音助手，集成智能对话和文本转语音功能，支持多种声音选择，可调节语速和语调。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://libretts.is-an.org/">
    <meta property="og:image" content="https://libretts.is-an.org/image/TTS.png">
    <meta property="og:site_name" content="LibreTTS">
    <meta property="og:locale" content="zh_CN">
    
    <!-- Twitter Card标签 -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AI语音助手 | 智能对话+文本转语音 - LibreTTS">
    <meta name="twitter:description" content="LibreTTS AI语音助手，集成智能对话和文本转语音功能。">
    <meta name="twitter:image" content="https://libretts.is-an.org/image/TTS.png">
    
    <!-- 样式和脚本引用 -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <!-- 网站图标 -->
    <link rel="icon" type="image/png" href="image/TTS.png">
    <link rel="apple-touch-icon" href="image/TTS.png">
    <link rel="shortcut icon" type="image/png" href="image/TTS.png">

    <!-- 预加载关键资源 -->
    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="script.js" as="script">
    
    <!-- Umami Analytics -->
    <script defer src="https://umami.zwei.de.eu.org/script.js" data-website-id="70106ca4-d1e5-4563-b574-ba09c3b5db16"></script>
</head>
<body>
    <!-- 密码验证弹窗 -->
    <div id="passwordModal" class="modal" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index:1000;">
        <div class="modal-dialog" style="max-width: 400px; margin: 15% auto;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">请输入访问密码</h5>
                </div>
                <div class="modal-body">
                    <input type="password" id="passwordInput" class="form-control" placeholder="密码">
                    <div id="passwordError" class="alert alert-danger mt-2" style="display:none;"></div>
                </div>
                <div class="modal-footer">
                    <button id="passwordSubmit" class="btn btn-primary">提交</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 主导航 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-robot text-primary"></i>
                <span class="ml-2">AI语音助手</span>
            </a>
            <div class="navbar-nav ml-auto">
                <button class="btn btn-outline-primary btn-sm" id="toggleMode">
                    <i class="fas fa-exchange-alt"></i>
                    <span id="modeText">切换到TTS模式</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- AI对话模式 -->
        <div id="chatMode" class="mode-container">
            <div class="row justify-content-center">
                <!-- AI对话区域 -->
                <div class="col-12 col-lg-8 mb-4">
                    <div class="card chat-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4 class="mb-0">
                                <i class="fas fa-comments text-white"></i>
                                AI智能对话
                            </h4>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-light" id="settingsBtn" title="设置">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <button class="btn btn-sm btn-light" id="clearChatBtn" title="清空对话">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <!-- 对话历史 -->
                            <div id="chatHistory" class="chat-history">
                                <div class="welcome-message">
                                    <div class="text-center p-4">
                                        <i class="fas fa-robot fa-3x text-primary mb-3"></i>
                                        <h5>你好！我是你的AI语音助手 🤖</h5>
                                        <p class="text-muted">我可以和你聊天，并且会用语音朗读我的回复哦～</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 输入区域 -->
                            <div class="chat-input-area">
                                <div class="input-group">
                                    <textarea id="chatInput" class="form-control" placeholder="输入你想说的话..." rows="2"></textarea>
                                    <div class="input-group-append">
                                        <button class="btn btn-primary" id="sendBtn" type="button">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 语音控制面板 -->
                <div class="col-12 col-lg-4 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-volume-up text-white"></i>
                                语音控制
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- 语音设置 -->
                            <div class="form-group">
                                <label for="chatApi">选择API：</label>
                                <div class="input-group">
                                    <select class="form-control" id="chatApi">
                                        <option value="edge-api">Edge API</option>
                                        <option value="oai-tts">OAI-TTS API</option>
                                    </select>
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" id="manageChatApiBtn">
                                            <i class="fas fa-cog"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="chatSpeaker">选择语音：</label>
                                <select class="form-control" id="chatSpeaker">
                                    <option value="">加载中...</option>
                                </select>
                            </div>

                            <div id="chatRateContainer" class="form-group">
                                <label for="chatRate">语速: <span id="chatRateValue">0</span></label>
                                <input type="range" class="form-control-range" id="chatRate" min="-100" max="100" value="0">
                            </div>

                            <div id="chatPitchContainer" class="form-group">
                                <label for="chatPitch">语调: <span id="chatPitchValue">0</span></label>
                                <input type="range" class="form-control-range" id="chatPitch" min="-100" max="100" value="0">
                            </div>

                            <!-- 播放控制 -->
                            <div class="audio-controls mt-4">
                                <h6>播放控制</h6>
                                <div class="btn-group btn-group-sm w-100 mb-3">
                                    <button class="btn btn-success" id="playBtn" disabled>
                                        <i class="fas fa-play"></i> 播放
                                    </button>
                                    <button class="btn btn-warning" id="pauseBtn" disabled>
                                        <i class="fas fa-pause"></i> 暂停
                                    </button>
                                    <button class="btn btn-danger" id="stopBtn" disabled>
                                        <i class="fas fa-stop"></i> 停止
                                    </button>
                                    <button class="btn btn-info" id="replayBtn" disabled>
                                        <i class="fas fa-redo"></i> 重播
                                    </button>
                                </div>
                                
                                <audio id="chatAudio" controls class="w-100" style="display: none;">
                                    您的浏览器不支持音频播放。
                                </audio>
                            </div>

                            <!-- 自动播放设置 -->
                            <div class="form-check mt-3">
                                <input class="form-check-input" type="checkbox" id="autoPlay" checked>
                                <label class="form-check-label" for="autoPlay">
                                    自动播放AI回复
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TTS模式 -->
        <div id="ttsMode" class="mode-container" style="display: none;">
            <div class="row w-100 justify-content-center g-4">
                <!-- 表单容器 -->
                <div class="col-12 col-md-8 col-lg-6 col-xl-5 mb-3">
                    <div class="card shadow-sm h-100">
                        <div class="card-header text-center">
                            <h2>文本转语音</h2>
                        </div>
                        <div class="card-body">
                            <form id="text2voice-form">
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="api">选择API：</label>
                                        <div class="input-group">
                                            <select class="form-control" id="api" required>
                                                <option value="edge-api">Edge API</option>
                                                <option value="oai-tts">OAI-TTS API</option>
                                            </select>
                                            <div class="input-group-append">
                                                <button class="btn btn-outline-secondary" type="button" id="manageApiBtn">
                                                    <i class="fas fa-cog"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <small id="apiTips" class="form-text text-muted"></small>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="speaker">选择语音：</label>
                                        <select class="form-control" id="speaker" required>
                                            <option value="">加载中...</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <label for="text">输入文本：</label>
                                        <div id="pauseControls" class="input-group" style="width: auto;">
                                            <input type="number"
                                                   class="form-control form-control-sm"
                                                   id="pauseSeconds"
                                                   min="0.01"
                                                   max="100"
                                                   step="0.01"
                                                   style="width: 80px;"
                                                   placeholder="秒数">
                                            <div class="input-group-append">
                                                <button class="btn btn-sm btn-outline-secondary" type="button" id="insertPause">
                                                    插入停顿
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <textarea
                                        class="form-control"
                                        id="text"
                                        rows="4"
                                        required
                                        maxlength="100000"></textarea>
                                    <small id="charCount" class="form-text text-muted">0% (0/100000单位)</small>
                                </div>

                                <!-- OAI-TTS专用设置 -->
                                <div id="instructionsContainer" class="form-group" style="display: none;">
                                    <label for="instructions">语音指令（可选）：</label>
                                    <input type="text" class="form-control" id="instructions" 
                                        placeholder="如：请用欢快和兴奋的语气说话">
                                    <small class="form-text text-muted">可用于指导语音情感、语气或风格</small>
                                </div>

                                <div id="formatContainer" class="form-group" style="display: none;">
                                    <label for="audioFormat">音频格式：</label>
                                    <select class="form-control" id="audioFormat">
                                        <option value="mp3">MP3</option>
                                        <option value="opus">Opus</option>
                                        <option value="aac">AAC</option>
                                        <option value="flac">FLAC</option>
                                        <option value="wav">WAV</option>
                                        <option value="pcm">PCM</option>
                                    </select>
                                </div>

                                <!-- 其他API使用的语速语调设置 -->
                                <div id="rateContainer" class="form-group">
                                    <label for="rate">语速: <span id="rateValue">0</span></label>
                                    <input type="range" class="form-control-range" id="rate" name="rate" min="-100" max="100" value="0">
                                </div>

                                <div id="pitchContainer" class="form-group">
                                    <label for="pitch">语调: <span id="pitchValue">0</span></label>
                                    <input type="range" class="form-control-range" id="pitch" name="pitch" min="-100" max="100" value="0">
                                </div>

                                <div id="error" class="alert alert-danger" style="display: none;"></div>

                                <button type="button" class="btn btn-info btn-block mb-3" id="previewButton">试听前20个字</button>
                                <button type="button" class="btn btn-primary btn-block" id="generateButton">生成语音</button>
                            </form>

                            <div class="mt-4" id="result">
                                <audio id="audio" controls class="w-100"></audio>
                                <a id="download" class="btn btn-success btn-block mt-3" href="#" download="voice.mp3">下载语音文件</a>
                            </div>

                            <div class="mt-4 text-center" id="loading" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i> 正在生成语音，请稍候...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 历史记录容器 -->
                <div class="col-12 col-md-8 col-lg-6 col-xl-5 mb-3">
                    <div class="card shadow-sm h-100">
                        <div class="card-header text-center">
                            <h2>历史记录</h2>
                        </div>
                        <div class="card-body history-container">
                            <button onclick="clearHistory()" class="btn btn-warning btn-block mb-3">清除历史</button>
                            <div id="historyItems"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI设置弹窗 -->
    <div class="modal fade" id="aiSettingsModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-robot"></i>
                        AI助手设置
                    </h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="aiApiUrl">AI API地址：</label>
                        <input type="url" class="form-control" id="aiApiUrl" 
                               placeholder="https://api.openai.com/v1/chat/completions">
                        <small class="form-text text-muted">支持OpenAI兼容的API接口</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="aiApiKey">API密钥：</label>
                        <input type="password" class="form-control" id="aiApiKey" 
                               placeholder="sk-...">
                    </div>
                    
                    <div class="form-group">
                        <label for="aiModel">模型：</label>
                        <input type="text" class="form-control" id="aiModel" 
                               placeholder="gpt-3.5-turbo" value="gpt-3.5-turbo">
                    </div>
                    
                    <div class="form-group">
                        <label for="systemPrompt">系统提示词（智能体设定）：</label>
                        <textarea class="form-control" id="systemPrompt" rows="6" 
                                  placeholder="你是一个友善的AI助手...">你是一个友善、有趣的AI语音助手。请用简洁、自然的语言回复用户，保持对话轻松愉快。回复长度控制在100字以内，除非用户特别要求详细解释。</textarea>
                        <small class="form-text text-muted">这里设置AI的角色和行为方式，类似智能体的提示词</small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="temperature">创造性 (Temperature)：</label>
                            <input type="range" class="form-control-range" id="temperature" 
                                   min="0" max="2" step="0.1" value="0.7">
                            <small class="form-text text-muted">值越高回复越有创意：<span id="tempValue">0.7</span></small>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="maxTokens">最大回复长度：</label>
                            <input type="number" class="form-control" id="maxTokens" 
                                   value="150" min="50" max="1000">
                            <small class="form-text text-muted">控制AI回复的最大长度</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveAiSettings">保存设置</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 自定义API管理弹窗 -->
    <div class="modal fade" id="apiManagerModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">管理自定义API</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> 您可以添加自定义的TTS API。支持两种格式：OpenAI格式和Edge API格式。
                    </div>
                    
                    <form id="customApiForm">
                        <div class="form-group">
                            <label for="apiName">API名称</label>
                            <input type="text" class="form-control" id="apiName" placeholder="例如: 我的自定义API" required>
                        </div>
                        <div class="form-group">
                            <label for="apiFormat">API格式</label>
                            <select id="apiFormat" class="form-control">
                                <option value="openai">OpenAI 格式</option>
                                <option value="edge">Edge API 格式</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="apiEndpoint">API端点URL</label>
                            <input type="url" class="form-control" id="apiEndpoint" placeholder="https://api.example.com/v1/audio/speech" required>
                        </div>
                        <div class="form-group">
                            <label for="apiKey">API密钥（可选）</label>
                            <input type="password" class="form-control" id="apiKey" placeholder="sk-...">
                        </div>
                        <div class="form-group">
                            <label for="modelEndpoint">模型列表端点</label>
                            <input type="url" class="form-control" id="modelEndpoint" placeholder="https://api.example.com/v1/models">
                        </div>
                        <div class="form-group">
                            <label for="manualSpeakers">自定义讲述人列表</label>
                            <textarea id="manualSpeakers" class="form-control" rows="2" placeholder="voice1,voice2,voice3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">保存API</button>
                    </form>
                    
                    <hr>
                    <h6>已保存的自定义API</h6>
                    <div id="savedApisList" class="list-group mt-3">
                        <!-- 动态加载已保存的API -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center py-3 mt-3" style="background-color: #f8f9fa; font-size: 0.9rem;">
        <p class="mb-1">
            <a href="https://zwei.de.eu.org" target="_blank">Zwei</a> | 
            <a href="https://github.com/LibreSpark/LibreTTS" target="_blank">Code</a>
        </p>
        <p class="mb-0">
            由 <a href="https://www.nodeseek.com/post-305185-1" target="_blank">NodeSupport</a> 和 
            <a href="https://yxvm.com/aff.php?aff=819" target="_blank">YXVM</a> 赞助
        </p>
    </footer>

    <!-- 密码验证脚本 -->
    <script>
        // 检查是否需要密码
        fetch('/api/check-password')
            .then(res => res.json())
            .then(data => {
                if (data.requirePassword && localStorage.getItem('authenticated') !== 'true') {
                    document.getElementById('passwordModal').style.display = 'block';
                }
            })
            .catch(err => {
                console.error('检查密码需求失败', err);
            });
            
        document.getElementById('passwordSubmit').addEventListener('click', function() {
            const passValue = document.getElementById('passwordInput').value;
            fetch('/api/verify-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: passValue })
            })
            .then(res => {
                if (res.status === 200) return res.json();
                else throw new Error('密码错误');
            })
            .then(result => {
                if (result.valid) {
                    localStorage.setItem('authenticated', 'true');
                    document.getElementById('passwordModal').style.display = 'none';
                }
            })
            .catch(error => {
                const errBox = document.getElementById('passwordError');
                errBox.style.display = 'block';
                errBox.innerText = error.message;
            });
        });
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="script.js"></script>

</body>
</html>